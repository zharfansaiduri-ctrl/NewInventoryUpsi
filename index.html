<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Kehadiran + Permohonan Aset</title>
<link rel="icon" type="image/x-icon" href="img/UHSB-Logo-resize.png">
<link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family:'League Spartan',sans-serif; background:#f2f2f2; padding:20px; }
.form-container { max-width:500px; margin:auto; background:white; padding:30px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.1); }
.logo-container { display:flex; justify-content:center; gap:10px; margin-bottom:20px; }
.logo-container img { height:40px; object-fit:contain; }
h1 { text-align:center; margin-bottom:20px; }
label { font-weight:600; display:block; margin-top:12px; margin-bottom:4px; }
input, select, button { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:14px; }
button { background:#0d6efd; color:white; border:none; cursor:pointer; margin-top:12px; }
button:hover { background:#084298; }
.hidden { display:none; }
#nameDropdown { border:1px solid #ccc; background:white; max-height:180px; overflow-y:auto; position:absolute; z-index:1000; display:none; }
#nameDropdown .name-option { padding:8px; cursor:pointer; }
#nameDropdown .name-option:hover { background:#eef6ff; }
.message { margin-top:12px; padding:10px; border-radius:10px; display:none; text-align:center; font-weight:600; }
.success { background:#D1FAE5; color:#065F46; border:1px solid #6EE7B7; }
.error { background:#FEE2E2; color:#991B1B; border:1px solid #FCA5A5; }
</style>
</head>
<body>

<div class="form-container">
    <div class="logo-container">
        <img src="img/UPSI-&-100-Tahun.png" alt="UPSI">
        <img src="img/UHSB.png" alt="UHSB">
        <img src="img/ASWARA.png" alt="ASWARA">
    </div>

    <h1>Sistem Kehadiran & Permohonan Aset</h1>

    <form id="attendanceForm">
        <label for="namaInput">Nama <span style="color:red">*</span></label>
        <input type="text" id="namaInput" name="nama" placeholder="Taip untuk cari nama" autocomplete="off" required>
        <div id="nameDropdown"></div>

        <label for="jabatan">Jabatan <span style="color:red">*</span></label>
        <input type="text" id="jabatan" name="jabatan" required>

        <label for="jenisSelect">Jenis Aset / Kategori</label>
        <select id="jenisSelect">
            <option value="">-- Pilih --</option>
            <option value="alat_tulis">Alat Tulis</option>
            <option value="kenderaan">Kenderaan</option>
            <option value="projektor">Projektor</option>
            <option value="kertas_a4">Kertas A4</option>
        </select>

        <input type="text" id="item" placeholder="Jenis / Bilangan" class="hidden">
        <input type="text" id="tempoh" placeholder="Tempoh" class="hidden">
        <input type="number" id="kuantiti" placeholder="Kuantiti" class="hidden">

        <button type="submit" id="submitBtn">Hantar</button>
    </form>

    <div id="message" class="message"></div>
</div>

<script>
const SESSION_API   = 'https://script.google.com/macros/s/AKfycbwLLs-2eeSwx2V61GZZo8h8BiVmSrbBEdfUBHi_tVl0F7Lzqedr3V82nmNPH39D5gSt/exec';
const NAMES_API     = 'https://script.google.com/macros/s/AKfycbxasoAjEyWdr57vkkotprtYckPZlKrEFkWySrMkTi1_wLMlTkgUij7uTvAILPrzvrmv/exec';
const POST_API = {
     alat_tulis: "https://script.google.com/macros/s/AKfycbz0msu-Bk1yexgmVsrtPt9vbvu5xqJZLFlj43Bk5JMCJUugCMBlbPOafnSgXbdVsnk6iQ/exec",
  kenderaan: "https://script.google.com/macros/s/AKfycbyNvyn-WzAB-GSx3Fpcd-JD9JmUwPCW4nu2VQh6zKpn5q3Maqgt0Y4UU-Z_CYg_p77fUg/exec",
  projektor: "https://script.google.com/macros/s/AKfycbwfEoubXcvGINSJoAb2r1HT_akTO7WFQxh4hV3Q_X0EuXZ6I78hJk4Ll8edN99dfmL_/exec",
  kertas_a4: "https://script.google.com/macros/s/AKfycbzhBY_KhGAFRGea-_sNb_yd9QRIXyNBlKNrK5zv5lCYyByGjKgGufZNgYvgCIOug2nH/exec"
};

let namesData = [];

async function loadNamesData(){
    try{
        const res = await fetch(NAMES_API);
        namesData = await res.json();
    }catch(err){
        console.error('Error loading names', err);
    }
}

const namaInput = document.getElementById('namaInput');
const jabatan = document.getElementById('jabatan');
const nameDropdown = document.getElementById('nameDropdown');
const form = document.getElementById('attendanceForm');
const message = document.getElementById('message');

namaInput.addEventListener('input', ()=>{
    const query = namaInput.value.toLowerCase().trim();
    if(query.length<2){ nameDropdown.style.display='none'; return; }
    const filtered = namesData.filter(item=>item.Nama.toLowerCase().includes(query));
    if(filtered.length===0){ nameDropdown.style.display='none'; return; }
    nameDropdown.innerHTML='';
    filtered.forEach(item=>{
        const div = document.createElement('div');
        div.className='name-option';
        div.textContent=item.Nama;
        div.onclick=()=>{
            namaInput.value=item.Nama;
            jabatan.value=item.Jabatan || '';
            nameDropdown.style.display='none';
        };
        nameDropdown.appendChild(div);
    });
    nameDropdown.style.display='block';
});

document.addEventListener('click', e=>{
    if(!namaInput.contains(e.target) && !nameDropdown.contains(e.target)){
        nameDropdown.style.display='none';
    }
});

document.getElementById('jenisSelect').addEventListener('change', function(){
    const type=this.value;
    ['item','tempoh','kuantiti'].forEach(id=>document.getElementById(id).classList.add('hidden'));
    if(type==='alat_tulis'){ document.getElementById('item').placeholder='Jenis Alat'; document.getElementById('item').classList.remove('hidden'); document.getElementById('kuantiti').classList.remove('hidden'); }
    if(type==='kenderaan'){ document.getElementById('item').placeholder='Jenis Kenderaan'; document.getElementById('item').classList.remove('hidden'); document.getElementById('tempoh').classList.remove('hidden'); }
    if(type==='projektor'){ document.getElementById('item').placeholder='Bilangan Projektor'; document.getElementById('item').classList.remove('hidden'); document.getElementById('tempoh').classList.remove('hidden'); }
    if(type==='kertas_a4'){ document.getElementById('kuantiti').classList.remove('hidden'); }
});

form.addEventListener('submit', async e=>{
    e.preventDefault();
    const jenis=document.getElementById('jenisSelect').value;
    if(!jenis){ alert('Sila pilih jenis aset'); return; }

    const data={
        Nama: namaInput.value,
        Jabatan: jabatan.value,
        JenisAlatan: document.getElementById('item').value || '-',
        Tempoh: document.getElementById('tempoh').value || '-',
        Kuantiti: document.getElementById('kuantiti').value || '-',
        Timestamp: new Date().toLocaleString("ms-MY")
    };

    try{
        const res = await fetch(POST_API[jenis],{
            method:'POST',
            headers:{ 'Content-Type':'application/x-www-form-urlencoded' },
            body: new URLSearchParams({data: JSON.stringify(data)})
        });
        const result = await res.json();
        if(result.status==='success'){
            message.textContent='✅ Data berjaya direkod';
            message.className='message success';
            form.reset();
        } else {
            message.textContent='✗ Ralat: '+(result.message||'Tidak diketahui');
            message.className='message error';
        }
        message.style.display='block';
        setTimeout(()=>message.style.display='none',5000);
    }catch(err){
        console.error(err);
        message.textContent='✗ Ralat semasa menghantar';
        message.className='message error';
        message.style.display='block';
    }
});

document.addEventListener('DOMContentLoaded', loadNamesData);
</script>

</body>
</html>
