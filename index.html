<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Permohonan Aset</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  padding:20px;
}
.box {
  max-width:500px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:10px;
}
input, select, button {
  width:100%;
  padding:10px;
  margin:8px 0;
}
button {
  background:#0d6efd;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover { background:#084298; }
.hidden { display:none; }

#suggestions {
  border:1px solid #ccc;
  background:#fff;
}
#suggestions div:hover {
  background:#f1f1f1;
}
#msg {
  margin-top:10px;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="box">
  <h2>Permohonan Aset</h2>

  <!-- ðŸ”¹ FORM SUBMIT TERUS KE APPS SCRIPT -->
  <form id="form" method="POST" target="hidden_iframe">
    <input name="nama" id="nama" placeholder="Nama" autocomplete="off" required>
    <div id="suggestions" class="hidden"></div>

    <input name="jabatan" id="jabatan" placeholder="Jabatan" required>

    <select id="jenis" required>
      <option value="">-- Pilih Aset --</option>
      <option value="alat_tulis">Alat Tulis</option>
      <option value="kenderaan">Kenderaan</option>
      <option value="projektor">Projektor</option>
      <option value="kertas_a4">Kertas A4</option>
    </select>

    <!-- Hidden fields untuk Apps Script -->
    <input type="hidden" name="jenis_alatan" id="jenisAlatan">
    <input type="hidden" name="kuantiti" id="kuantitiFinal">
    <input type="hidden" name="timestamp" id="timestamp">

    <!-- Input dinamik -->
    <input id="item" placeholder="Jenis / Bilangan" class="hidden">
    <input id="tempoh" placeholder="Tempoh" class="hidden">
    <input id="kuantiti" type="number" placeholder="Kuantiti" class="hidden">

    <button type="submit">Hantar</button>
  </form>

  <iframe name="hidden_iframe" class="hidden"></iframe>

  <p id="msg"></p>
</div>

<script>
/* ================== URL API ================== */
const GET_API = "https://script.google.com/macros/s/AKfycbxasoAjEyWdr57vkkotprtYckPZlKrEFkWySrMkTi1_wLMlTkgUij7uTvAILPrzvrmv/exec";

const POST_API = {
  alat_tulis: "https://script.google.com/macros/s/AKfycbysWg0tzHmL0ZPqp9-PhCFvu3XGO60PvAESveM2G76vFk4z0gyewmaCIUecYVAERYrjyw/exec",
  kenderaan: "https://script.google.com/macros/s/AKfycbzpBeU7nF41zL12FY19VMIrJPBbADyOVT7KbURlXW11jDgDYqhI6gVIOaR61YniIRP9FA/exec",
  projektor: "https://script.google.com/macros/s/AKfycbxFZj__pccSeDFOz3N2pjdtGbCeQAOZVoIRrYjmDkEUC6IGuDL4ikpyZWlJCVoH0mycZQ/exec",
  kertas_a4: "https://script.google.com/macros/s/AKfycby0BD7cuLyV8fQSL3jOy9_6MjGL57WRYh9wN_668gzfcJChqKUEaH-AqyGKE7ArgwF4/exec"
};

/* ================== ELEMENT ================== */
const nama = document.getElementById("nama");
const jabatan = document.getElementById("jabatan");
const jenis = document.getElementById("jenis");
const item = document.getElementById("item");
const tempoh = document.getElementById("tempoh");
const kuantiti = document.getElementById("kuantiti");

const jenisAlatan = document.getElementById("jenisAlatan");
const kuantitiFinal = document.getElementById("kuantitiFinal");
const timestamp = document.getElementById("timestamp");

const form = document.getElementById("form");
const msg = document.getElementById("msg");
const suggestions = document.getElementById("suggestions");

/* ================== AUTOCOMPLETE ================== */
nama.addEventListener("input", async () => {
  const q = nama.value.trim();
  if (q.length < 2) return suggestions.classList.add("hidden");

  const res = await fetch(`${GET_API}?search=${encodeURIComponent(q)}`);
  const data = await res.json();

  if (!data.length) return suggestions.classList.add("hidden");

  suggestions.innerHTML = "";
  data.forEach(r => {
    const d = document.createElement("div");
    d.innerText = r.Nama;
    d.style.padding = "6px";
    d.onclick = () => {
      nama.value = r.Nama;
      jabatan.value = r.Dept;
      suggestions.classList.add("hidden");
    };
    suggestions.appendChild(d);
  });
  suggestions.classList.remove("hidden");
});

/* ================== FIELD CONTROL ================== */
function updateField(type) {
  [item,tempoh,kuantiti].forEach(i=>i.classList.add("hidden"));

  if(type==="alat_tulis"){item.placeholder="Jenis Alat";item.classList.remove("hidden");kuantiti.classList.remove("hidden");}
  if(type==="kenderaan"){item.placeholder="Jenis Kenderaan";item.classList.remove("hidden");tempoh.classList.remove("hidden");}
  if(type==="projektor"){item.placeholder="Bilangan Projektor";item.classList.remove("hidden");tempoh.classList.remove("hidden");}
  if(type==="kertas_a4"){kuantiti.classList.remove("hidden");}
}
jenis.addEventListener("change",()=>updateField(jenis.value));

/* ================== SUBMIT (SET HIDDEN + ACTION) ================== */
form.addEventListener("submit", () => {
  timestamp.value = new Date().toLocaleString("ms-MY");

  if (jenis.value === "alat_tulis") {
    jenisAlatan.value = item.value;
    kuantitiFinal.value = kuantiti.value;
  }

  if (jenis.value === "kenderaan") {
    jenisAlatan.value = item.value + " (" + tempoh.value + ")";
    kuantitiFinal.value = "-";
  }

  if (jenis.value === "projektor") {
    jenisAlatan.value = "Projektor (" + tempoh.value + ")";
    kuantitiFinal.value = item.value;
  }

  if (jenis.value === "kertas_a4") {
    jenisAlatan.value = "Kertas A4";
    kuantitiFinal.value = kuantiti.value;
  }

  // ðŸ”¥ SET ENDPOINT IKUT JENIS
  form.action = POST_API[jenis.value];

  msg.innerText = "Permohonan berjaya dihantar âœ…";
  setTimeout(()=>form.reset(),500);
});
</script>
</body>
</html>
